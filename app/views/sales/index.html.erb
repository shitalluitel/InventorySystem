<div class="sale">
  <div class="row">
    <div class="col-md-12">

      <div class="row">
        <div class="col-md-6 pull-right">
          <a class="btn btn-primary pull-right" href="<%= new_sale_path %>"><span><i class="fa fa-plus fa-fw">&nbsp;</i></span>
            Add New</a>
        </div>
      </div>
      <br>

      <div class="row">
        <div class="col-md-12">

          <table class="table table-hover">
            <thead>
            <tr class="bg-primary">
              <th>S.N.</th>
              <th>Bill Number</th>
              <th>Customer</th>
              <th>Total Cost</th>
              <th>Discount</th>
              <th>Tax</th>
              <th>Date</th>
              <th>Fiscal Year</th>
              <th>Remaining Day</th>
            </tr>
            </thead>
            <tbody>
            <% @sales.each_with_index do |f, i| %>
                <% if f.customer.customer_name === "Cash" %>
                    <tr data-toggle="toggle" class="bg-success">
                <% else %>
                    <% if ((f.date + f.credit_limit) - Date.today).to_f < 5 && ((f.date + f.credit_limit) - Date.today).to_f > 0%>
                        <tr style="background-color: #ffccb2;">
                    <% elsif ((f.date + f.credit_limit) - Date.today).to_f <= 0 %>
                        <tr data-toggle="toggle" style="background-color: #ff8568;">
                    <% elsif ((f.date + f.credit_limit) - Date.today).to_f >5  %>
                        <tr >
                    <% end %>
                <% end %>
                <td><%= (@page.to_i - 1) * @perpage+ i+1 %></td>
                <td><a href="<%= get_sale_path(f) %>"><%= f.bill_number %></a></td>
                <td>
                  <a href="<%= customer_path(f.customer_id) %>"><%= f.customer.customer_name %></a>
                </td>
                <td>
                  <%= f.total %>
                </td>
                <td>
                  <%= f.discount %>
                </td>
                <td>
                  <%= f.tax_amount %>
                </td>
                <td>
                  <%= f.date %>
                </td>
                <td>
                  <%= f.fiscal_year %>
                </td>
                <% if f.customer.customer_name === "Cash" %>
                    <td title="Transaction In cash" data-toggle="toggle" class="col-md-2">
                <% else %>
                    <td title="Payment Day: <%= f.date + f.credit_limit %>" data-toggle="toggle">
                <% end %>
                  <% if (f.credit_limit.present?) %>
                    <% @date = ((f.date + f.credit_limit) - Date.today ).to_f %>
                  <%  end %>
                  <% if f.customer.customer_name === "Cash" %>
                    In Cash
                  <% else %>
                    <% if @date > 0  %>
                        <%= @date %>
                    <% else %>
                        Credit Limit Crossed (<%= @date.abs %> <%= @date > 1 ? "Days" : "Day" %> )
                    <% end %>
                  <% end %>
                </td>

                </tr>
            <% end %>
            </tbody>
          </table>

        </div>
      </div>

      <%= will_paginate @sale, renderer: BootstrapPagination::Rails %>

    </div>
  </div>

</div>
<script type="text/javascript" charset="utf-8">
  $(document).ready(function () {
    $('[data-toggle="toggle"]').tooltip();
  });
</script>